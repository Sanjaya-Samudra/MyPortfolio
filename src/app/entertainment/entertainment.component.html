<div class="stage"
     (pointerdown)="onPointerDown($event)"
     (pointerup)="onPointerUp($event)">

  <video class="bg" autoplay muted loop playsinline preload="auto">
    <source src="https://cdn.pixabay.com/video/2019/02/04/21161-315224572_large.mp4" type="video/mp4" />
  </video>

  <div class="aurora" aria-hidden="true"></div>
  <div class="beams" aria-hidden="true"></div>
  <div class="grain" aria-hidden="true"></div>
  <div class="vignette" aria-hidden="true"></div>

  <div class="panel app">
    <header class="hero">
      <div class="hero-left">
        <div class="emblem" aria-hidden="true">
          <div class="emblem-core"></div>
          <div class="emblem-ring"></div>
          <div class="emblem-ring r2"></div>
          <div class="sparkle" aria-hidden="true"></div>
        </div>

        <div class="hero-text">
          <div class="kicker">STUDIO LAB</div>
          <h1 class="hero-title">Immersive Works & Micro‑Experiments</h1>

          <div class="subline">
            <span class="sub-badge">Discover Collections</span>
            <span class="sub-dot"></span>
            <span class="sub-badge">Tap tokens to jump</span>
            <span class="sub-dot"></span>
            <span class="sub-badge">Swipe to explore</span>
          </div>

          <div class="hero-underline" aria-hidden="true"></div>
        </div>
      </div>

      <nav class="cats" aria-label="Categories">
        <button *ngFor="let c of categories"
                type="button"
                class="cat"
                [class.active]="c === selectedCategory"
                (click)="selectCategory(c)"
                [attr.data-cat]="c">
          <span class="cat-orb" aria-hidden="true"></span>
          <span class="cat-label">{{ c }}</span>
          <span class="cat-sheen" aria-hidden="true"></span>
        </button>
      </nav>
    </header>

    <main class="carousel" aria-label="Carousel">
      <button class="nav prev" type="button" (click)="prev()" aria-label="Previous">
        <span aria-hidden="true">‹</span>
      </button>

      <div class="viewport" aria-label="Viewport">
        <div class="track" [ngStyle]="trackStyle()">
          <section *ngFor="let item of filteredItems; let i = index; trackBy: trackById"
                   class="slide"
                   [class.active]="i === activeIndex">

            <div class="cardShell">
              <article class="card">
                <div class="left">
                  <div class="mediaFrame">
                    <img class="heroImg"
                         [class.fading]="isPreviewFading(item)"
                         [src]="imgSrc(item.images[getPreviewIndex(item)])"
                         [alt]="item.title + ' preview'"
                         loading="lazy" />
                  </div>

                  <div class="badge">{{ item.category }}</div>

                  <div class="miniCount" *ngIf="item.images.length > 1">
                    {{ item.images.length }} shots
                  </div>
                </div>

                <div class="right">
                  <div class="heading">
                    <h3 class="title">{{ item.title }}</h3>
                    <div class="hint">Preview is cropped • Use Gallery for full view</div>
                    <div class="dividerGlow" aria-hidden="true"></div>
                  </div>

                  <div class="scrollArea">
                    <div class="metaGrid" aria-label="Quick stats">
                      <div class="metaChip">
                        <div class="metaLabel">Category</div>
                        <div class="metaValue">{{ item.category }}</div>
                      </div>
                      <div class="metaChip">
                        <div class="metaLabel">Photos</div>
                        <div class="metaValue">{{ item.images.length }}</div>
                      </div>
                      <div class="metaChip">
                        <div class="metaLabel">Tags</div>
                        <div class="metaValue">{{ item.tags.length }}</div>
                      </div>
                    </div>

                    <div class="tags" aria-label="Tags">
                      <span class="tag" *ngFor="let t of item.tags">{{ t }}</span>
                    </div>
                  </div>

                  <div class="actions">
                    <button class="galleryBtn" type="button" (click)="openModal(item, 0)">
                      View Gallery
                      <span class="count">{{ item.images.length }}</span>
                      <span class="shine" aria-hidden="true"></span>
                    </button>
                  </div>
                </div>
              </article>
            </div>

          </section>
        </div>
      </div>

      <button class="nav next" type="button" (click)="next()" aria-label="Next">
        <span aria-hidden="true">›</span>
      </button>
    </main>

    <footer class="iconBar" aria-label="Item navigation">
      <button *ngFor="let item of filteredItems; let i = index"
              type="button"
              class="iconBtn"
              [class.on]="i === activeIndex"
              (click)="goTo(i)"
              [attr.aria-label]="'Open ' + item.title">
        <img class="iconImg" [src]="imgSrc(item.images[0])" alt="" />
        <div class="iconPreview">
          <div class="pTitle">{{ item.title }}</div>
        </div>
      </button>
    </footer>
  </div>

  <!-- MODAL -->
  <div class="modalOverlay" *ngIf="modalOpen" (click)="closeModal()" role="dialog" aria-modal="true">
    <div class="modal" (click)="$event.stopPropagation()">

      <div class="modalTop">
        <div class="modalTitle">
          {{ modalItem?.title }}
          <span class="modalMeta" *ngIf="modalItem">• {{ modalImageIndex + 1 }} / {{ modalItem.images.length }}</span>
        </div>
        <button class="modalClose" type="button" (click)="closeModal()" aria-label="Close">✕</button>
      </div>

      <div class="modalBody">
        <button class="mNav" type="button" (click)="modalPrev()" aria-label="Previous image">‹</button>

        <div class="modalStage">
          <div class="modalImageFrame">
            <img class="modalImg"
                 *ngIf="modalItem"
                 [src]="imgSrc(modalItem.images[modalImageIndex])"
                 [alt]="modalItem.title + ' image'"
                 loading="eager" />
          </div>
        </div>

        <button class="mNav" type="button" (click)="modalNext()" aria-label="Next image">›</button>
      </div>

      <div class="modalThumbs" *ngIf="modalItem">
        <button class="mThumb"
                *ngFor="let img of modalItem.images; let idx = index"
                type="button"
                [class.on]="idx === modalImageIndex"
                (click)="selectModalImage(idx)"
                [attr.aria-label]="'Select image ' + (idx + 1)">
          <img [src]="imgSrc(img)" alt="" />
        </button>
      </div>

    </div>
  </div>

</div>
