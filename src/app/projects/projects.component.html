<div class="scene-container"
     #scene
     (mousemove)="onScenePointerMove($event)"
     (mouseleave)="onScenePointerLeave()"
     (touchmove)="onSceneTouchMove($event)"
     (touchend)="onScenePointerLeave()">

  <div class="video-bg-container absolute inset-0 overflow-hidden pointer-events-none">
    <video #bgVideo autoplay loop muted playsinline class="bg-video">
      <source src="https://cdn.pixabay.com/video/2019/02/04/21161-315224572_large.mp4" type="video/mp4">
    </video>

    <div class="video-overlay-color"></div>
    <div class="video-overlay-vignette"></div>
    <div class="video-overlay-grid"></div>
    <div class="video-overlay-noise"></div>
  </div>

  <div class="carousel-wrapper"
       (pointerdown)="onDragStart($event)"
       (pointermove)="onDragMove($event)"
       (pointerup)="onDragEnd($event)"
       (pointercancel)="onDragEnd($event)"
       (pointerleave)="onDragEnd($event)">

    <div class="carousel" [style.transform]="getContainerTransform()">
      <div class="mirror-floor"></div>

      <div *ngFor="let p of projects; let i = index"
           class="card cursor-pointer"
           [class.active-card]="i === activeProjectIndex"
           [style.transform]="getTransform(i)"
           [style.filter]="'blur(' + getBlur(i) + 'px)'"
           (click)="bringToFront(i)">

        <div class="card-shell relative w-full h-full rounded-[32px] overflow-hidden transition-all duration-300 group">

          <div class="card-glass absolute inset-0"></div>
          <div class="card-border absolute inset-0"></div>

          <div class="card-sheen absolute -inset-full top-0 block h-[200%] w-[200%] -rotate-45 translate-x-[-70%]
                      transition-all duration-1000 group-hover:translate-x-[55%] z-10 pointer-events-none"></div>

          <div class="relative h-[50%] w-full p-2 z-20">
            <div class="w-full h-full rounded-[24px] overflow-hidden shadow-sm relative group/image ring-1 ring-slate-100/60">
              <img [src]="p.image" class="w-full h-full object-cover transition-transform duration-700 group-hover/image:scale-110">
              <div class="absolute inset-0 bg-gradient-to-b from-black/5 to-transparent pointer-events-none"></div>
              <div class="absolute top-3 right-3">
                <span class="px-2.5 py-1 year-pill text-[10px] font-black rounded-lg">{{ p.year }}</span>
              </div>
            </div>
          </div>

          <div class="relative h-[50%] flex flex-col justify-between px-4 pb-4 pt-2 z-20">
            <div class="flex flex-col gap-2">
              <h3 class="text-sm md:text-base font-black text-slate-800 leading-none tracking-tight drop-shadow-sm">
                {{ p.name }}
              </h3>

              <div class="flex flex-wrap gap-2">
                <div *ngFor="let tech of p.technologies"
                     class="tech-icon group/icon relative flex items-center justify-center w-8 h-8 rounded-full transition-all duration-300 hover:scale-125 cursor-pointer">
                  <img [src]="'/' + getIcon(tech)" class="w-5 h-5 object-contain opacity-80 group-hover/icon:opacity-100" [alt]="tech">
                  <div class="tooltip absolute top-full mt-1 left-1/2 -translate-x-1/2 px-2 py-0.5 text-[9px] font-bold rounded
                              opacity-0 group-hover/icon:opacity-100 transition-all duration-200 transform -translate-y-1 group-hover/icon:translate-y-0
                              pointer-events-none whitespace-nowrap z-[60]">
                    {{ tech }}
                  </div>
                </div>
              </div>
            </div>

            <a [href]="p.link"
               target="_blank"
               (click)="$event.stopPropagation()"
               class="hyper-button group/btn relative w-full overflow-hidden rounded-2xl shadow-lg active:scale-95 transition-all duration-300 z-10">
              <div class="absolute inset-0 btn-gradient"></div>
              <div class="absolute inset-0 bg-gradient-to-b from-white/25 to-transparent"></div>

              <div class="relative z-10 flex items-center justify-center gap-2 py-3 text-white">
                <span class="text-xs font-bold uppercase tracking-wider">View Project</span>
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"
                     stroke-linecap="round" stroke-linejoin="round"
                     class="transition-transform group-hover/btn:translate-x-1 group-hover/btn:-translate-y-1">
                  <path d="M7 17L17 7"></path>
                  <path d="M7 7h10v10"></path>
                </svg>
              </div>
            </a>
          </div>

        </div>
      </div>
    </div>
  </div>

  <div class="controls-container z-[100]">
    <div class="carousel-mov">

      <div class="controls-row">
        <div class="controls-pill">
          <button (click)="rotate('prev')" class="nav-btn group" aria-label="Previous">
            <svg width="20" height="20" class="group-hover:-translate-x-0.5 transition-transform"
                 viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                 stroke-linecap="round" stroke-linejoin="round">
              <path d="m15 18-6-6 6-6" />
            </svg>
          </button>

          <button (click)="playPause()" class="nav-btn play" [attr.aria-label]="isPlaying ? 'Pause' : 'Play'">
            <svg *ngIf="isPlaying" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                 stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
              <rect x="6" y="4" width="4" height="16"></rect>
              <rect x="14" y="4" width="4" height="16"></rect>
            </svg>
            <svg *ngIf="!isPlaying" width="20" height="20" class="ml-1" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                 stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
              <polygon points="5,3 19,12 5,21 5,3"></polygon>
            </svg>
          </button>

          <button (click)="rotate('next')" class="nav-btn group" aria-label="Next">
            <svg width="20" height="20" class="group-hover:translate-x-0.5 transition-transform"
                 viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
                 stroke-linecap="round" stroke-linejoin="round">
              <path d="m9 18 6-6-6-6" />
            </svg>
          </button>
        </div>

        <div class="jump-container relative">
          <button class="jump-glass cursor-pointer" (click)="toggleDropdown($event)">
              <span class="jump-icon">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                  <circle cx="11" cy="11" r="8"></circle>
                  <path d="m21 21-4.3-4.3"></path>
                </svg>
              </span>

            <span class="jump-text truncate max-w-[140px] text-white font-semibold text-sm">
                 {{ projects[activeProjectIndex].name }}
              </span>

            <div class="jump-arrow ml-3" [class.rotate-180]="isDropdownOpen">
              <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                <path d="m6 9 6 6 6-6"/>
              </svg>
            </div>
          </button>

          <div *ngIf="isDropdownOpen"
               class="custom-options-list overflow-y-auto rounded-2xl border border-white/20 bg-slate-900/80 backdrop-blur-xl shadow-2xl">

            <div *ngFor="let p of projects; let i = index"
                 (click)="selectJump(i)"
                 class="flex items-center justify-between px-4 py-3 cursor-pointer transition-colors duration-200 border-b border-white/5 last:border-0 hover:bg-indigo-500/30 group">

                <span class="text-sm font-medium text-slate-200 group-hover:text-white transition-colors">
                  {{ p.name }}
                </span>

              <span class="text-[10px] font-bold opacity-50 group-hover:opacity-100 bg-white/10 px-2 py-0.5 rounded text-white">
                  {{ p.year }}
                </span>
            </div>
          </div>
        </div>

      </div>

      <div class="dots" aria-label="Project indicators">
        <button *ngFor="let p of projects; let i = index"
                class="dot"
                [class.on]="i === activeProjectIndex"
                (click)="goTo(i)"
                [attr.aria-label]="'Go to ' + p.name">
        </button>
      </div>

    </div>
  </div>

</div>